<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Loan Applications - Imani Credit</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="body">

<!-- NAVBAR -->
<nav class="navbar">
  <div class="logo">
    <img src="/static/images/logo.png" alt="Imani Credit Logo">
  </div>

  <ul class="nav-links">
    <li><a href="/">Home</a></li>
    <li><a href="/apply-loan">Apply Loan</a></li>
    <li><a href="/my-applications">My Applications</a></li>
    <li><a href="#">Faqs</a></li>
    <li><a href="#">Contact</a></li>
  </ul>

  {% if session.user_id %}
    <a href="/dashboard" class="btn-primary">{{ session.firstname }}</a>
    <a href="/logout" class="btn-nav">Logout</a>
  {% else %}
    <a href="/signup" class="btn-primary">Sign up</a>
    <a href="/login" class="btn-nav">Sign In</a>
  {% endif %}
</nav>

<section class="hero">
  <div class="hero-overlay"></div>
  <div class="hero-content animate">
    <h1>My Loan Applications</h1>
    <p>Review your submitted loan requests and their status.</p>

    {% if applications %}
    <table class="applications-table">
    <div class="table-container">
        <thead>
          <tr>
            <th>Date Submitted</th>
            <th>Loan Amount</th>
            <th>Income</th>
            <th>Debt</th>
            <th>Credit Score</th>
            <th>Employment Years</th>
            <th>Risk Score</th>
            <th>Recommendation</th>
            <th>Status</th>
          </tr>
        </thead>

        <tbody>
          {% for app in applications %}
          {% set risk = app.risk_details %}

          <!-- Main Row -->
          <tr>
            <td data-label="Date Submitted">
              {{ app.created_at.strftime('%Y-%m-%d') if app.created_at else 'N/A' }}
            </td>
            <td data-label="Loan Amount">{{ app.loan_amount }}</td>
            <td data-label="Income">{{ app.income }}</td>
            <td data-label="Debt">{{ app.debt }}</td>
            <td data-label="Credit Score">{{ app.credit_score }}</td>
            <td data-label="Employment Years">{{ app.employment_years }}</td>
            <td data-label="Risk Score">{{ app.risk_score or 'N/A' }}</td>
            <td data-label="Recommendation">
              {{ app.recommendation if app.recommendation else 'Pending' }}
            </td>
            <td data-label="Status">
              {{ app.status.capitalize() if app.status else 'Pending' }}
            </td>
          </tr>

          <!-- Explainability Row -->
          {% if risk %}
          <tr class="risk-details-row">
            <td colspan="9">
              <details>
                <summary><strong>View Risk Explainability</strong></summary>

                <div style="margin-top: 10px;">
                  <h4>Breakdown</h4>
                  <ul>
                    {% for key, value in risk.breakdown.items() %}
                      <li>
                        {{ key.replace('_', ' ').title() }}: {{ value }}%
                      </li>
                    {% endfor %}
                  </ul>

                  <h4>Financial Ratios</h4>
                  <ul>
                    {% for key, value in risk.ratios.items() %}
                      <li>
                        {{ key.replace('_', ' ').title() }}: {{ value }}
                      </li>
                    {% endfor %}
                  </ul>
                </div>
              </details>
            </td>
          </tr>
          {% endif %}

          {% endfor %}
        </tbody>
      </table>
    </div>

    {% else %}
      <p>You have not submitted any loan applications yet.</p>
      <a href="/apply-loan" class="btn-primary">Apply for a Loan</a>
    {% endif %}

  </div>
</section>

<script src="/static/js/script.js"></script>
</body>
</html>
